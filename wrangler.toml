name = "saavy-uptime"
main = "apps/backend/build/index.js"
compatibility_date = "2025-11-11"
workers_dev = false

[vars]
ACCESS_TEAM_DOMAIN = "https://<your-team>.cloudflareaccess.com"
ACCESS_AUD = "<access-audience-tag>"
DISPATCH_TOKEN = "change-me"
DISPATCH_URL = "http://localhost:8787"
ENABLE_TICKER_ADMIN = 0
AE_ACCOUNT_ID = "00000000-0000-0000-0000-000000000000"
AE_HEARTBEATS_DATASET = "saavy_uptime_heartbeats"

[build]
command = "bash scripts/build-backend.sh"

[[durable_objects.bindings]]
name = "TICKER"
class_name = "Ticker"
script_name = "saavy-uptime"

[[services]]
binding = "DISPATCH_SERVICE"
service = "saavy-uptime"

[[migrations]]
tag = "v1"
new_classes = ["Ticker"]

[[secrets_store_secrets]]
binding = "AE_API_TOKEN"
store_id = "00000000000000000000000000000000"
secret_name = "AE_API_TOKEN"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
[observability.traces]
enabled = true
head_sampling_rate = 1

[[d1_databases]]
binding = "DB"
database_name = "saavy_uptime_default"
database_id = "00000000-0000-0000-0000-000000000000"
preview_database_id = "00000000-0000-0000-0000-000000000000"
migrations_dir = "apps/backend/db/migrations"
migrations_table = "d1_migrations"

[[analytics_engine_datasets]]
binding = "AE_HEARTBEATS"
dataset = "saavy_uptime_heartbeats"

[[r2_buckets]]
binding = "ARCHIVE_BUCKET"
bucket_name = "saavy-uptime-archive"
preview_bucket_name = "saavy-uptime-archive-preview"

# ========================================
# PREVIEW ENVIRONMENT
# ========================================
[env.preview]
name = "saavy-uptime-preview"
workers_dev = true

[env.preview.vars]
ACCESS_TEAM_DOMAIN = "https://<your-team>.cloudflareaccess.com"
ACCESS_AUD = "<access-audience-tag>"
DISPATCH_TOKEN = "change-me"
DISPATCH_URL = "https://saavy-uptime-preview.<your-subdomain>.workers.dev"
ENABLE_TICKER_ADMIN = 1
AE_ACCOUNT_ID = "<analytics-account-id>"
AE_HEARTBEATS_DATASET = "saavy_uptime_heartbeats_preview"

[[env.preview.durable_objects.bindings]]
name = "TICKER"
class_name = "Ticker"
script_name = "saavy-uptime-preview"

[[env.preview.services]]
binding = "DISPATCH_SERVICE"
service = "saavy-uptime-preview"

[[env.preview.migrations]]
tag = "v1"
new_classes = ["Ticker"]

[[env.preview.secrets_store_secrets]]
binding = "AE_API_TOKEN"
store_id = "00000000000000000000000000000000"
secret_name = "AE_API_TOKEN"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "saavy_uptime_preview"
database_id = "00000000-0000-0000-0000-000000000000"
preview_database_id = "00000000-0000-0000-0000-000000000000"
migrations_dir = "apps/backend/db/migrations"
migrations_table = "d1_migrations"

[[env.preview.analytics_engine_datasets]]
binding = "AE_HEARTBEATS"
dataset = "saavy_uptime_heartbeats_preview"

[[env.preview.r2_buckets]]
binding = "ARCHIVE_BUCKET"
bucket_name = "saavy-uptime-archive-preview"
preview_bucket_name = "saavy-uptime-archive-preview"

# ========================================
# PRODUCTION ENVIRONMENT
# ========================================
[env.production]
name = "saavy-uptime"
workers_dev = false

[env.production.vars]
ACCESS_TEAM_DOMAIN = "https://<your-team>.cloudflareaccess.com"
ACCESS_AUD = "<access-audience-tag>"
DISPATCH_TOKEN = "change-me"
DISPATCH_URL = "https://saavy-uptime.<your-subdomain>.workers.dev"
ENABLE_TICKER_ADMIN = 0
AE_ACCOUNT_ID = "<analytics-account-id>"
AE_HEARTBEATS_DATASET = "saavy_uptime_heartbeats"

[[env.production.durable_objects.bindings]]
name = "TICKER"
class_name = "Ticker"
script_name = "saavy-uptime"

[[env.production.services]]
binding = "DISPATCH_SERVICE"
service = "saavy-uptime"

[[env.production.secrets_store_secrets]]
binding = "AE_API_TOKEN"
store_id = "00000000000000000000000000000000"
secret_name = "AE_API_TOKEN"

[[env.production.d1_databases]]
binding = "DB"
database_name = "saavy_uptime"
database_id = "00000000-0000-0000-0000-000000000000"
migrations_dir = "apps/backend/db/migrations"
migrations_table = "d1_migrations"

[[env.production.analytics_engine_datasets]]
binding = "AE_HEARTBEATS"
dataset = "saavy_uptime_heartbeats"

[[env.production.r2_buckets]]
binding = "ARCHIVE_BUCKET"
bucket_name = "saavy-uptime-archive"
